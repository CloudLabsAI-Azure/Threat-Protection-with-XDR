# Lab 10 - Mitigate threats using Microsoft Defender for Cloud

## Lab scenario

You're a Security Operations Analyst working at a company that implemented Microsoft Defender for Cloud. You need to respond to security alerts generated by Microsoft Defender for Cloud.

## Lab objectives
 In this lab, you will perform the following:
- Task 1: Explore Regulatory Compliance
- Task 2: Explore Security posture and recommendations
- Task 3: Mitigate security alerts

## Architecture Diagram

  ![Picture 1](./media/SC200-Lab_Diagrams_Mod3_L1_Ex2.png)
  
### Task 1: Simulated Attacks

In this task, you will run two simulated attacks to explore the capabilities of Microsoft Defender for Endpoint.

1. If you are not already at the Microsoft 365 Defender portal in your Microsoft Edge browser, go to (https://security.microsoft.com). 

1. In the **Sign in** dialog box, copy and paste * Email/Username: <inject key="AzureAdUserEmail"></inject> and then select Next.

1. In the **Enter password** dialog box, copy and paste * Password: <inject key="AzureAdUserPassword"></inject> and then select **Sign in**.

1. From the menu, under **Endpoints**, select **Evaluation & tutorials** and then select **Tutorials & simulations** from the left side.

1. Select the **Tutorials** tab.

1. Under *Automated investigation (backdoor)* you will see a message describing the scenario. Below this paragraph, click **Read the walkthrough**. A new browser tab opens which includes instructions to perform the simulation.

1. In the new browser tab, locate the section named **Run the simulation** (page 5, starting at step 2) and follow the steps to run the attack. **Hint:** The simulation file *RS4_WinATP-Intro-Invoice.docm* can be found back in portal, just below the **Read the walkthrough** you selected in the previous step by selecting the **Get simulation file** button. 

1. After downloading the file,  open the file with **Microsoft Word** and enter the password as `WDATP!diy#`.

1. In the Sign in dialog box, click on **Sign in** copy and paste in the Username and password provided in the environment details page, and select next.    

1. Click **Enable Editing** if the document opens inProtectedView. If you see a subsequent security warning about macros being disabled.    

1. To unblock the document, navigate to its location in File Explorer. In File Explorer, right-click the document, and select Properties. In the General tab, mark the Unblock option under Security.   

   ![Picture 1](./media/SC-200-img21.png)  

1. Close the **Microsoft Word** and re-open from the File Explorer and enter the password as `WDATP!diy#` after re-opening click on **Enable Content** and click on **OK**. 

1. In the Command prompt pop-up press any key to close. 
   
   
    >**Note:** **Congrats – you’re done running the attack!** The attack simulation ends here. A real attacker, if successful, would likely continue to scan for information, send collected reconnaissance information to a command-and-control (C&C) server, and use this information to move laterally and pursue other attractive targets. Next, let’s review and investigate the Defender for Endpoint alerts that surfaced in the simulated attack. **Note:** Alerts should start to appear 15-30 minutes after the simulated backdoor is launched.   

1. Go back to the portal and in *Automated investigation (fileless attack)* click on **Copy simulation script**.

1. Right-click the Windows Start button and select **Windows PowerShell (Admin)**.  

    ![Picture 1](./media/SC-200-module6-ex2-img5.png). 

1. At the Windows PowerShell, paste and run the provided script. A few seconds later, notepad.exe is started and the simulated attack code is injected into it. The simulated attack code attempts communication to an external IP address simulating the C&C server.

### Task 2: Investigate the Attacks

1. In the Microsoft 365 Defender portal select **Incidents & alerts** from the left menu bar, then select **Incidents**.

1. A new incident called "Multi-stage incident..." is in the right pane. Click the incident name to load its details.

1. Select the **Manage incident** button and a new window blade appears. 

1. Under **Incident tags** type "Tutorial" and select **Tutorial (Create new)** to create a new tag. 

1. Select the toggle **Assign to** and add your user account (Me) as the owner of the incident. 

1. Under **Classification**, expand the drop-down menu. 

1. Under **Informational, expected activity**, select **Security testing**. 

1. Add any comments if desired and click **Save** to finish.

1. Review the contents of the Alerts, Devices, Users, Investigations, Evidence, Response, and Graph tabs. **Hint:** Some tabs might be hidden due to the size of your display. Select the ellipsis tab (...) to make them appear.

>**Warning:** The simulations and tutorials here are an excellent source of learning through practice.  Simulations and tutorials are being added and edited regularly in the portal.  However, some of these simulations & tutorials may interfere with the performance of the labs designed for this training course.  Only perform the simulations and tutorials recommended in the instructions provided for this lab when using the course provided Azure tenant.  You may perform the other simulations and tutorials *after* this training course is complete with this tenant.

### Task 1: Explore Regulatory Compliance

In this task, you will load sample security alerts and review the alert details.  

1. Login to WIN1 virtual machine with the password as provided in the environment tab.

1. In the Edge browser, open the Azure portal at (https://portal.azure.com).

1. In the **Sign in** dialog box, copy and paste Email/Username: <inject key="AzureAdUserEmail"></inject> and then select Next.

1. In the **Enter password** dialog box, copy and paste Password: <inject key="AzureAdUserPassword"></inject> and then select **Sign in**.

1. In the Search bar of the Azure portal, type *Defender*, then select **Microsoft Defender for Cloud**.

1. Under *Cloud Security*, select **Regulatory compliance** in the portal menu.

1. Select **Managed compliance policies** on the toolbar.

1. Select your subscription.

1. On the left menu Under *Policy settings*, select **Security policy** in the portal menu.

1. Review the "Industry & regulatory standards" available to you by default.

1. Select Microsoft Defender for Cloud below the search box to return to the main blade.

### Task 2: Explore Security posture and recommendations

In this task, you will review cloud security posture management. The Secure Score information can take 24 hours to recalculate.  It is beneficial to do this task again in 24 hours.

1. On the left menu Under *Cloud Security*, select **Security posture** in the portal menu.

1. The Secure score most likely will show *N/A* until the score is calculated.

1. Under *General*, select **Recommendations** in the portal menu.

1. Explore Recommendations provided (after 24 hours).

### Task 3: Mitigate security alerts

In this task, you will load sample security alerts and review the alert details.

1. Under *General*, select **Security alerts** in the portal menu.

1. Select **Sample alerts** from the command bar. **Hint:** you may need to select the ellipsis (...) button from the command bar).

1. In the **Create sample alerts (Preview)** pane make sure your subscription is selected and that all sample alerts are selected in the *Defender for Cloud plans* area.

1. Select **Create sample alerts**.  

    >**Note:** This sample alert creation process may take a few minutes to complete, wait for the "Successfully created sample alerts" notification. Once complete each of the alerts should appear in the *Security alerts* area.

1. For the alerts that grabbed your attention, perform the following actions:

    - Select any one alert from the list, and information about the alert should appear. Select **View full details**.

    - Review and read the **Alert details** tab.

    - Select the **Take action** tab or select the **Next: Take Action** button at the end of the page.

    - Review the *Take action* information. Notice the sections available to take action depending on the type of alert: Inspect resource context, Mitigate the threat, prevent future attacks, Trigger automated response, and Suppress similar alerts.

## Review
In this lab, you have completed the following:
- Explored Regulatory Compliance
- Explored Security posture and recommendations
- Mitigated security alerts
